apply plugin: 'idea'
apply plugin: 'war'
apply plugin: 'jetty'

task buildAdmin(type: GradleBuild) {
    buildFile = '../admin-web/build.gradle'
    tasks = ['build']
}

task buildOpenLmis(type: GradleBuild) {
    buildFile = '../core-web/build.gradle'
    tasks = ['build']
}

war.doFirst {
    tasks.buildAdmin.execute()
    tasks.buildOpenLmis.execute()
    from zipTree(project(':modules:admin-web').war.archivePath)  //exclude { details -> details.file.name.endsWith('.xml') && details.file.text.contains('web') }
    from zipTree(project(':modules:core-web').war.archivePath) //exclude { details -> details.file.name.endsWith('.xml') && details.file.text.contains('web') }
    into('WEB-INF') {
        from 'src/main/webapp/WEB-INF/web.xml'
    }
}

task jettyRunWarDaemon(dependsOn:jettyRunWar){
    jettyRunWar.daemon=true
    jettyRunWar.httpPort=9090
    jettyRunWar.contextPath='openlmis'

}



task explodedWar(type: Copy) {
    into "$buildDir/exploded"
    with war
}

