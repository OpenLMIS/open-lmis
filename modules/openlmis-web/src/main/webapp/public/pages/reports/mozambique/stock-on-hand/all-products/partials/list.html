<div>
    <div id="control-bar">

        <h3 class="report-title" openlmis-message="title.all.products.report"></h3>

        <div ng-include="'/public/pages/reports/mozambique/facility-selection.html'"></div>

        <div class="form-cell report-selection">
            <label>
                <span openlmis-message="label.date"></span>
            </label>

            <div class="form-field">
                <input name="endTime" id="endTime" type="text"
                       ui-date="{ dateFormat: 'dd/mm/yy' }"
                       ui-date-format
                       ng-model="reportParams.endTime"
                       ng-required="true"
                       ng-change="checkDateBeforeToday()"/>

              <span class="field-error" ng-show="createPeriodForm.startDate.$error.required && showErrorForCreate"
                    openlmis-message="missing.value"></span>
            </div>
        </div>

        <div class="report-selection">
            <input type="submit" class="btn btn-primary" ng-click="loadReport()"
                   openlmis-message="button.generateReport"/>
        </div>

        <div style="clear: both"></div>
    </div>

    <hr/>

    <div id="report" ng-if="reportData" class="stock-on-hand-all">
        <h3 class="report-title" openlmis-message="subtitle.all.product.report|reportData[0]['facility.facility_name']"></h3>
        <div class="report-subtitle">
            <h4 class="report-total-entries"  openlmis-message="label.report.data.total|reportData.length"></h4>
            <div ng-include="'/public/pages/reports/mozambique/search-field.html'"></div>
        </div>
        <table class="table table-condensed table-bordered table-striped fixed-header-table header-table">
            <tr class="gradient-header">
                <th ng-click="sortType = 'drug_name'; sortReverse = !sortReverse" class="sortable sort-desc"
                    openlmis-message="report.drug.name">
                    <span ng-show="sortType != 'drug_name'" class="icon-sort"></span>
                    <span ng-show="sortType == 'drug_name' && !sortReverse" class="icon-sort-up"></span>
                    <span ng-show="sortType == 'drug_name' && sortReverse" class="icon-sort-down"></span></th>
                <th ng-click="sortType = 'soh'; sortReverse = !sortReverse" class="sortable sort-desc"
                    openlmis-message="report.drug.quantity">
                    <span ng-show="sortType != 'soh'" class="icon-sort"></span>
                    <span ng-show="sortType == 'soh' && !sortReverse" class="icon-sort-up"></span>
                    <span ng-show="sortType == 'soh' && sortReverse" class="icon-sort-down"></span></th>
                <th ng-click="sortType = 'expiry_date'; sortReverse = !sortReverse" class="sortable sort-desc"
                    openlmis-message="report.soonest.expiry.date">
                    <span ng-show="sortType != 'expiry_date'" class="icon-sort"></span>
                    <span ng-show="sortType == 'expiry_date' && !sortReverse" class="icon-sort-up"></span>
                    <span ng-show="sortType == 'expiry_date' && sortReverse" class="icon-sort-down"></span></th>
                <th ng-click="sortType = 'estimated_months'; sortReverse = !sortReverse" class="sortable sort-desc"
                    openlmis-message="report.estimated.consumption.month">
                    <span ng-show="sortType != 'estimated_months'" class="icon-sort"></span>
                    <span ng-show="sortType == 'estimated_months' && !sortReverse" class="icon-sort-up"></span>
                    <span ng-show="sortType == 'estimated_months' && sortReverse" class="icon-sort-down"></span></th>
            </tr>
        </table>
        <div class="content-table">
            <table class="table table-condensed table-bordered table-striped fixed-header-table" enableVerticalScrollbar="2">
                <tr ng-repeat="entry in reportData | orderBy:sortType:sortReverse | filter: partialPropertiesFilter(searchValue)">
                    <td ng-show="viewStockMovementToggle">
                        <a href="#/stock-movements/product/{{entry.drug_code}}/facility/{{entry['facility.facility_code']}}"
                            ng-click="saveHistory()">{{entry.drug_name}} [{{entry.drug_code}}]</a>
                    </td>
                    <td ng-show="!viewStockMovementToggle">{{entry.drug_name}} [{{entry.drug_code}}]
                    </td>
                    <td style="text-align: right" ng-class="cmmStatus(entry)">
                        <span class="label label-warning low-stock-tag" openlmis-message="stock.cmm.low.stock">
                        </span>
                        <span class="label label-info over-stock-tag" openlmis-message="stock.cmm.over.stock">
                        </span>
                        <span>
                            {{entry.soh | number:0}}
                        </span>
                    </td>
                    <td><a ng-click="redirectToLotExpiryDateReport(entry.drug_code)" style="cursor:pointer;" ng-show="entry.soonest_expiring_loh">
                        <span>{{entry.formatted_expiry_date}} (</span>
                        <span openlmis-message="report.stock.on.hand.amount"></span>
                        <span>{{entry.soonest_expiring_loh}})</span>
                    </a></td>
                    <td class="align-right"><span ng-hide="angular.isUndefined(entry.estimated_months)"><img src="/public/images/exclamation.png" class="exclamation" ng-show="hasExpirationRisk(entry)"> {{entry.estimated_months}}</span></td>
                </tr>
            </table>
        </div>
        <div>
            <div ng-include="'/public/pages/reports/mozambique/export-data-button.html'"></div>
        </div>

        <div class="footer-wrapper">
            <p class="report-title" openlmis-message="message.last.updated.date"><b>&nbsp&nbsp{{reportData[0].formatted_last_sync_date}}</b></p>
            <ng-include src="'/public/pages/reports/mozambique/product-report-footer.html'"/>
        </div>

    </div>
    <label ng-show="reportData && reportData.length == 0" openlmis-message="label.report.empty"></label>

</div>
