<div class="rnr-table" ng-controller="CreateRnrController">
    <div ng-hide="programRnRColumnList">Loading...</div>
       <form name="saveRnrForm" ng-submit="saveRnr()" id="save-rnr" novalidate>
           <table class="table table-striped table-bordered">
               <thead>
               <tr>
                   <th class="col-{{programRnrColumn.name}}" ng-repeat="programRnrColumn in programRnRColumnList"  ng-show="showSelectedColumn(programRnrColumn.name)">
                       {{programRnrColumn.label}}
                   </th>
               </tr>
               </thead>
               <tbody ng-show="programRnRColumnList && (rnr.lineItems.length > 0)">
               <tr>
                   <td class="col-formula" ng-repeat="programRnrColumn in programRnRColumnList" ng-show="showSelectedColumn(programRnrColumn.name)">
                       <div class="indicator">{{programRnrColumn.indicator}}</div>
                       <div class="formula">{{programRnrColumn.formula}}</div>
                   </td>
               </tr>
               <tr ng-repeat="rnrLineItem in rnr.lineItems">
                   <input type="hidden" name="index" value="{{$index}}"/>
                   <td class="cell-input" ng-repeat="column in programRnRColumnList" ng-show="showSelectedColumn(column.name)">
                       <ng-switch on="column.source.name">
                           <span ng-switch-when="USER_INPUT">
                               <ng-switch on="column.name">
                                   <span ng-switch-when="beginningBalance">
                                     <input id="{{getId('A', $parent)}}" type="text"
                                            name="beginningBalance{{rnrLineItem['id']}}"
                                            ng-model="rnrLineItem[column.name]"
                                            rnr-validator="positiveInteger" maxlength="8"
                                            ng-change="rnrLineItem.fillCalculatedRnrColumns(rnrLineItem, rnr)"/>
                                     <span class="rnr-form-error" id="beginningBalance{{rnrLineItem['id']}}" style="display:none;">
                                      Enter Numeric Data
                                     </span>
                                   </span>

                                   <span ng-switch-when="quantityReceived">
                                       <input id="{{getId('B', $parent)}}" type="text"
                                              name="quantityReceived{{rnrLineItem['id']}}"
                                              ng-model="rnrLineItem[column.name]"
                                              rnr-validator="positiveInteger" maxlength="8"
                                              ng-change="fillCalculatedRnrColumns(rnrLineItem, rnr)"/>
                                       <span class="rnr-form-error" id="quantityReceived{{rnrLineItem['id']}}" style="display:none;">
                                        Enter Numeric Data
                                       </span>
                                   </span>

                                   <span ng-switch-when="quantityDispensed">
                                     <input id="{{getId('C', $parent)}}" type="text"
                                            name="quantityDispensed{{rnrLineItem['id']}}"
                                            ng-model="rnrLineItem[column.name]"
                                            rnr-validator="positiveInteger"
                                            ng-change="fillCalculatedRnrColumns(rnrLineItem, rnr)"
                                            maxlength="8"/>
                                     <span class="rnr-form-error" id="quantityDispensed{{rnrLineItem['id']}}" style="display:none;">
                                      Enter Numeric Data
                                     </span>
                                   </span>
<!--
                                   <span ng-switch-when="lossesAndAdjustments">
                                     <input id="{{getId('D', $parent)}}" type="text"
                                            name="lossesAndAdjustments{{rnrLineItem['id']}}"
                                            ng-model="rnrLineItem[column.name]"
                                            rnr-validator="positiveInteger"
                                            ng-change="fillCalculatedRnrColumns(rnrLineItem, rnr)"
                                            maxlength="8"/>
                                     <span class="rnr-form-error" id="lossesAndAdjustments{{rnrLineItem['id']}}" style="display:none;">
                                      Enter Numeric Data
                                     </span>
                                   </span>-->


                                   <span ng-switch-when="lossesAndAdjustments">
                                   <div id="lossesAndAdjustments" class="fade ng-pristine ng-valid modal hide" ui-modal=""
                                        ng-model="lossesAndAdjustmentsModal">
                                       <div class="modal-header"><h3>Losses And Adjustments</h3></div>
                                       <div class="modal-body">
                                           <table class="table table-striped">
                                               <tr ng-repeat="lossAndAdjustment in rnrLineItem[column.name]">
                                                   <td>{{lossAndAdjustment.type.name.description}}</td>
                                                   <td><input id="{{getId('D', $parent, true)}}" type="text"
                                                              name="lossesAndAdjustments{{lossAndAdjustment.id}}"
                                                              ng-model="lossAndAdjustment.quantity"
                                                              rnr-validator="positiveInteger"
                                                              maxlength="8"
                                                              ng-change="calculateTotalLossesAndAdjustments(rnrLineItem[column.name], rnrLineItem)"/>
                                                      <!--ng-change="fillCalculatedRnrColumns(rnrLineItem, rnr)"-->
                                                       <span class="rnr-form-error" id="lossesAndAdjustments{{lossAndAdjustment.id}}"
                                                       style="display:none;">
                                                       Enter Numeric Data
                                                       </span>

                                                   </td>
                                                   <td><a href="#" class="btn btn-danger" ng-click="removeLossAndAdjustment(lossAndAdjustment.id)"
                                                          data-dismiss="modal">Remove</a></td>
                                               </tr>
                                               <tr>
                                                   <td>Total</td>
                                                   <td>{{rnrLineItem.totalLossesAndAdjustments}}</td>
                                                   <td></td>
                                               </tr>
                                               <tr>
                                                   <td colspan="3"><b>Add new Loss/Adjustment</b></td>
                                               </tr>
                                               <tr>
                                                   <td>
                                                      <!-- <select id="operated-by" ng-model="facility.operatedBy.code"
                                                               ng-options="i.code as i.text for i in facilityOperators" ng-disabled="facility.dataReportable == 'false'">
                                                           <option value="">--Select Facility Operated By--</option>
                                                       </select>-->
                                                   </td>
                                               </tr>
                                           </table>
                                       </div>
                                       <div class="modal-footer">
                                           <a href="" class="btn btn-success save-button" ng-click="" data-dismiss="modal">Save Changes</a>
                                       </div>
                                   </div>
                                     <!--<input id="{{getId('D', $parent)}}" type="text"
                                            name="lossesAndAdjustments{{rnrLineItem['id']}}"
                                            ng-model="rnrLineItem[column.name]"
                                            rnr-validator="positiveInteger"
                                            ng-change="fillCalculatedRnrColumns(rnrLineItem, rnr)"
                                            maxlength="8"/>-->
                                      <a href="" ng-click="lossesAndAdjustmentsModal=true">Add loss/adjustment</a>
                                     <!--<span class="rnr-form-error" id="lossesAndAdjustments{{rnrLineItem['id']}}"-->
                                           <!--style="display:none;">-->
                                      <!--Enter Numeric Data-->
                                     <!--</span>-->
                                   </span>


                                   <span ng-switch-when="stockInHand">
                                     <input id="{{getId('E', $parent)}}" type="text" name="stockInHand{{rnrLineItem['id']}}"
                                            ng-model="rnrLineItem[column.name]"
                                            rnr-validator="positiveInteger"
                                            ng-change="fillCalculatedRnrColumns(rnrLineItem, rnr)" maxlength="8"/>
                                     <span class="rnr-form-error" id="stockInHand{{rnrLineItem['id']}}" style="display:none;">
                                      Enter Numeric Data
                                     </span>
                                   </span>

                                   <span ng-switch-when="newPatientCount">
                                     <input id="{{getId('F', $parent)}}" type="text"
                                            name="newPatientCount{{rnrLineItem['id']}}"
                                            ng-model="rnrLineItem[column.name]"
                                            rnr-validator="positiveInteger" maxlength="8"
                                            ng-change="fillCalculatedRnrColumns(rnrLineItem, rnr)"/>
                                     <span class="rnr-form-error" id="newPatientCount{{rnrLineItem['id']}}" style="display:none;">
                                      Enter Numeric Data
                                     </span>
                                   </span>

                                   <span ng-switch-when="quantityRequested">
                                     <input id="{{getId('J', $parent)}}" type="text"
                                            name="quantityRequested{{rnrLineItem['id']}}"
                                            ng-model="rnrLineItem[column.name]"
                                            rnr-validator="positiveInteger" maxlength="8"
                                            ng-change="fillCalculatedRnrColumns(rnrLineItem, rnr)"/>
                                     <span class="rnr-form-error" id="quantityRequested{{rnrLineItem['id']}}" style="display:none;">
                                      Enter Numeric Data
                                     </span>
                                   </span>

                                   <span ng-switch-when="quantityApproved">
                                     <input id="{{getId('K', $parent)}}" type="text"
                                            name="quantityApproved{{rnrLineItem['id']}}"
                                            ng-model="rnrLineItem[column.name]"
                                            rnr-validator="positiveInteger" maxlength="8"/>
                                     <span class="rnr-form-error" id="quantityApproved{{rnrLineItem['id']}}" style="display:none;">
                                      Enter Numeric Data
                                     </span>
                                   </span>

                                   <span ng-switch-when="remarks">
                                       <input id="{{getId('L', $parent)}}" type="text" name="remarks{{rnrLineItem['id']}}"
                                             ng-model="rnrLineItem[column.name]"
                                             maxlength="250"/>
                                   </span>

                                   <span ng-switch-when="reasonForLossesAndAdjustments">
                                       <input id="{{getId('S', $parent)}}" type="text"
                                            name="reasonForLossesAndAdjustments{{rnrLineItem['id']}}"
                                            ng-model="rnrLineItem[column.name]"
                                            maxlength="250"/>
                                   </span>

                                   <span ng-switch-when="reasonForRequestedQuantity">
                                       <input id="{{getId('W', $parent)}}" type="text"
                                            name="reasonForRequestedQuantity{{rnrLineItem['id']}}"
                                            ng-model="rnrLineItem[column.name]"
                                            ng-required="rnrLineItem.quantityRequested"
                                            maxlength="250"/>
                                          <span ng-show="rnrLineItem.quantityRequested && !rnrLineItem.reasonForRequestedQuantity">
                                          Please enter a reason
                                        </span>
                                   </span>

                                   <span ng-switch-when="stockOutDays">
                                       <input id="{{getId('X', $parent)}}" type="text" name="stockOutDays{{rnrLineItem['id']}}"
                                       ng-model="rnrLineItem[column.name]"
                                       rnr-validator="positiveInteger" maxlength="8"
                                       ng-change="fillCalculatedRnrColumns(rnrLineItem, rnr)"/>
                                       <span class="rnr-form-error" id="stockOutDays{{rnrLineItem['id']}}" style="display:none;">
                                       Enter Numeric Data
                                       </span>
                                   </span>
                               </ng-switch>
                           </span>
                           <span ng-switch-default>
                               <ng-switch on="column.name">
                                   <span ng-switch-when="price">
                                       <span id="{{'priceCurrency_'+$parent.$parent.$index}}" class="cell-text" ng-show="showCurrencySymbol(rnrLineItem[column.name])">
                                           {{currency}}
                                       </span>
                                       <span id="{{column.indicator+'_'+$parent.$parent.$index}}" ng-bind="rnrLineItem[column.name]"
                                           class="cell-text">
                                       </span>
                                   </span>
                                   <span ng-switch-when="cost">
                                       <span id="{{'costCurrency_'+$parent.$parent.$index}}" class="cell-text" ng-show="showCurrencySymbol(rnrLineItem[column.name])" >
                                           {{currency}}
                                       </span>
                                       <span id="{{column.indicator+'_'+$parent.$parent.$index}}" ng-bind="rnrLineItem[column.name]"
                                           class="cell-text">
                                       </span>
                                   </span>
                                    <span id="{{column.indicator+'_'+$parent.$parent.$index}}" ng-bind="rnrLineItem[column.name]"
                                          class="cell-text" ng-switch-default>
                                    </span>
                               </ng-switch>
                           </span>
                       </ng-switch>
                   </td>
               </tr>
               <tr>
                   <td>Total R&R Cost :</td>
                   <td>
                       <span id="totalCostCurrency" class="cell-text">
                                           {{currency}}
                       </span>
                       <span id="totalCost" ng-bind="rnr.totalSubmittedCost"
                             class="cell-text">
                       </span>
                   </td>
               </tr>

               </tbody>
           </table>
           <div class="alert alert-error" id="saveFailMessage" ng-model="error" ng-show="error">
               {{error}}
           </div>
           <div class="alert alert-success" id="saveSuccessMsgDiv" ng-model="message" ng-show="message">
               {{message}}
           </div>
           <input type="submit" class="btn" value="Save"/>
       </form>
   </div>